{"slots":{"0":{"name":"core","type":{"events":[],"methods":[]}},"1":{"name":"slot2","type":{"events":[],"methods":[]}},"2":{"name":"slot3","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"unit.hide()\npanelid = system.createWidgetPanel('Poor mans gyro')\n\n-- pitch\nwidgetPitchId = system.createWidget(panelid, \"value\")\n\npitchData = {\n    value = \"0\", \n    unit = \"\", \n    label = \"Pitch\"\n}\n\npitchDataId = system.createData(json.encode(pitchData))\n\nsystem.addDataToWidget(pitchDataId, widgetPitchId)\n\n-- roll\nrollId = system.createWidget(panelid, \"value\")\n\nrollData = {\n    value = \"0\", \n    unit = \"\", \n    label = \"roll\"\n}\n\nrollDataId = system.createData(json.encode(rollData))\nsystem.addDataToWidget(rollDataId, rollId)\n\n\n\n-- yolo round\nfunction round(number)\n    return number - (number % 1)\nend","filter":{"args":[],"signature":"start()","slotKey":"-1"},"key":"0"},{"code":"local down = vec3(core.getWorldVertical())\nlocal forward = vec3(core.getConstructWorldOrientationForward())\nlocal up = vec3(core.getConstructWorldOrientationUp())\n-- Pitch calculation\nlocal pitchCosine = down:dot(forward)\nlocal pitch = math.acos(pitchCosine)\nlocal pitchDeg = 90 - (pitch * constants.rad2deg)\n\n-- Roll calculation\nlocal horizon = down:cross(forward):normalize_inplace()\nlocal rollDeg = (math.acos(horizon:dot(up)) * constants.rad2deg) - 90\nlocal upCosine = down:dot(up)\nif upCosine > 0 then\n    rollDeg = 180 - rollDeg\nend\n\npitchData.value = round(pitchDeg, 2)\nsystem.updateData(pitchDataId, json.encode(pitchData))\n\nrollData.value = round(rollDeg, 2)\nsystem.updateData(rollDataId, json.encode(rollData))","filter":{"args":[],"signature":"update()","slotKey":"-2"},"key":"1"}],"methods":[],"events":[]}
